# ワークフローの名前
name: Build Thesis Document

# ワークフローが実行されるトリガーを指定
on:
  # mainブランチにプッシュされたときに実行
  push:
    branches:
      - main
      - master

  # 手動でも実行できるようにする
  workflow_dispatch:

# 実行されるジョブを定義
jobs:
  build:
    # ubuntuの最新版仮想環境で実行
    runs-on: ubuntu-latest

    # ジョブのステップを定義
    steps:
      # 1. リポジトリのコードをチェックアウトする
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. 出力ディレクトリを作成
      - name: Create output directory
        run: mkdir -p output

      # 3. Pandocとpandoc-crossrefを使用してドキュメントを変換
      # 公式例に基づいて、Dockerイメージを直接使用
      - name: Convert documents with Pandoc
        uses: docker://pandoc/latex:3.5
        with:
          args: >-
            --defaults=defaults.yaml
            --citeproc
            --bibliography=references.bib
            -V toc-title=目次
            -V lot-title=表目次
            -V lof-title=図目次
            --filter=pandoc-crossref
            --output=output/thesis.docx
            ./chapters/00_title.md
            ./chapters/01_abstract.md
            ./chapters/02_introduction.md
            ./chapters/03_related_work.md
            ./chapters/04_analysis.md
            ./chapters/05_proposal.md
            ./chapters/06_system_spec.md
            ./chapters/07_implementation.md
            ./chapters/08_evaluation.md
            ./chapters/09_discussion.md
            ./chapters/10_conclusion.md
            ./chapters/11_acknowledgements.md
            ./chapters/12_references_heading.md
            ./chapters/13_appendix.md

      # 4. 生成されたWordファイルをアーティファクトとしてアップロードする
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          # アーティファクトの名前
          name: thesis-document
          # アップロードするファイルのパス
          path: output/
