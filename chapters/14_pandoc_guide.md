# Pandoc Markdown システム使用ガイド

## はじめに

このシステムは、Pandocを使用してMarkdownからWord文書（.docx）への自動変換を行うシステムです。この章では、システムの使い方とPandoc用Markdownの構文について説明します。

## システムの基本的な使い方

### 1. ローカルでの変換

```bash
# Pythonスクリプトを使用した変換
python3 pandoc_runner.py

# または直接Pandocを使用
pandoc --defaults=defaults.yaml --citeproc --bibliography=references.bib --reference-doc=reference.docx -V toc-title=目次 -V lot-title=表目次 -V lof-title=図目次 --filter=pandoc-crossref --output=thesis.docx [chapter files]
```

### 2. GitHub Actionsでの自動変換

1. リポジトリにプッシュする
2. GitHub Actionsが自動的に実行される
3. Actions タブから生成されたWord文書をダウンロード

## Pandoc Markdown構文

### 基本構造

#### 見出し

```markdown
# 第1レベルの見出し（章）
## 第2レベルの見出し（節）
### 第3レベルの見出し（項）
#### 第4レベルの見出し（目）
```

**自動番号付け:**
- `# 序論` → `第1章 序論`
- `## 研究の背景` → `1.1 研究の背景`
- `### 技術的背景` → `1.1.1 技術的背景`
- `#### 従来技術の問題点` → `1.1.1.1 従来技術の問題点`

#### 段落

通常の段落は空行で区切ります。日本語の場合、段落の最初には全角スペース（　）が自動挿入されます。

```markdown
## 研究の背景

研究に至った経緯、背景となる社会の動向などについて説明する。
```

### 図表の書き方

#### 表の書き方

```markdown
表[@tbl:sample]に表のサンプルを示す。

| ヘッダー1 | ヘッダー2 | ヘッダー3 |
|:--- |:---:| ---:|
| データA | 123 | 左寄せ |
| データB | 456 | 中央寄せ |
| データC | 789 | 右寄せ |

: 表のサンプル（表には題名を付け、題名は表の上に書く） {#tbl:sample}
```

**重要なポイント：**
- 表の直後に `: 表の題名 {#tbl:識別子}` を記述
- 本文中では `表[@tbl:識別子]` で参照
- 表の配置は `:---` (左寄せ)、`:---:` (中央寄せ)、`---:` (右寄せ)

#### 図の書き方

```markdown
図[@fig:sample]に図のサンプルを示す。

![図の題名](画像ファイルのパス){#fig:sample}
```

**重要なポイント：**
- 画像の直後に `{#fig:識別子}` を記述
- 本文中では `図[@fig:識別子]` で参照
- 図の題名は画像のaltテキスト（`![題名]`）に記述

### 参考文献の書き方

#### references.bibファイルの構造

```bibtex
@article{sample2024,
  title = {サンプル論文のタイトル},
  author = {山田, 太郎 and 佐藤, 花子},
  journal = {情報処理学会論文誌},
  volume = {65},
  number = {3},
  pages = {123--130},
  year = {2024},
  publisher = {情報処理学会}
}

@book{book2024,
  title = {サンプル書籍のタイトル},
  author = {田中, 一郎},
  publisher = {サンプル出版社},
  year = {2024},
  address = {東京都}
}

@inproceedings{conf2024,
  title = {サンプル学会論文のタイトル},
  author = {鈴木, 次郎 and 高橋, 三郎},
  booktitle = {第XX回情報処理学会全国大会講演論文集},
  pages = {456--461},
  year = {2024},
  organization = {情報処理学会}
}
```

#### 本文での引用方法

```markdown
先行研究では[@sample2024]のように述べられている。
複数の文献を引用する場合は[@sample2024; @book2024]のように記述する。
ページ番号を指定する場合は[@sample2024, p. 125]のように記述する。
```

### 数式の書き方

#### インライン数式

```markdown
文中に数式を挿入する場合は $E = mc^2$ のように記述する。
```

#### ブロック数式

```markdown
$$
E = mc^2
$$
```

### リストの書き方

#### 順序なしリスト

```markdown
- 項目1
- 項目2
  - サブ項目2.1
  - サブ項目2.2
- 項目3
```

#### 順序ありリスト

```markdown
1. 最初の項目
2. 2番目の項目
   1. サブ項目2.1
   2. サブ項目2.2
3. 3番目の項目
```

### 強調・装飾

```markdown
**太字**
*斜体*
~~取り消し線~~
`インラインコード`
```

### リンク

```markdown
[リンクテキスト](https://example.com)
[内部リンク](#見出しのID)
```

## システム特有の機能

### 自動章番号付け

システムは自動的に章番号を付与します：

- `# 序論` → `第1章 序論`
- `## 研究の背景` → `1.1 研究の背景`

### 除外される見出し

以下の見出しは章番号付けの対象外です：

- 目次
- 内容梗概
- 謝辞
- 参考文献
- 付録
- List of Figures
- List of Tables
- List of Listings
- 修士論文

### 目次の自動生成

システムは以下の目次を自動生成します：

- **目次** (Table of Contents)
- **図目次** (List of Figures)
- **表目次** (List of Tables)

## トラブルシューティング

### よくある問題と解決方法

1. **図表の番号が表示されない**
   - `pandoc-crossref`フィルターが正しく動作しているか確認
   - 図表の識別子（`{#fig:sample}`など）が正しく記述されているか確認

2. **参考文献が表示されない**
   - `references.bib`ファイルが存在するか確認
   - 引用の構文が正しいか確認（`[@key]`形式）

3. **章番号が正しく表示されない**
   - `japanese_chapter.lua`フィルターが正しく動作しているか確認
   - 除外対象の見出しに`{-}`クラスが付いているか確認

4. **目次タイトルが英語のまま**
   - `japanese_toc_titles.lua`フィルターが正しく動作しているか確認

### デバッグ方法

変換時にコンソールに出力されるログを確認してください：

```
章番号付与: 1 - 序論
セクション番号付与: 1.1 - 研究の背景
除外: 内容梗概
```

これらのログから、どの要素がどのように処理されているかを確認できます。

## 参考資料

- [Pandoc公式ドキュメント](https://pandoc.org/MANUAL.html)
- [pandoc-crossrefドキュメント](https://lierdakil.github.io/pandoc-crossref/)
- [BibTeXスタイルガイド](https://www.bibtex.org/Format/)

## 更新履歴

- 2024-01-XX: 初版作成
